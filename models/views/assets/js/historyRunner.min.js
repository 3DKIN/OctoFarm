!function e(t,n,r){function a(i,c){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!c&&s)return s(i,!0);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};t[i][0].call(u.exports,(function(e){return a(t[i][1][e]||e)}),u,u.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=c(e("./lib/octofarm.js")),a=c(e("./lib/functions/calc.js")),o=c(e("./lib/functions/ui.js")),i=e("./lib/modules/filamentGrab.js");function c(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){s(o,r,a,i,c,"next",e)}function c(e){s(o,r,a,i,c,"throw",e)}i(void 0)}))}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}document.getElementById("historyTable").addEventListener("click",(function(e){e.preventDefault(),m.delete(e)})),document.getElementById("historyTable").addEventListener("click",(function(e){e.preventDefault(),m.edit(e)}));var d=[];$("#historyModal").on("hidden.bs.modal",(function(e){document.getElementById("historySaveBtn").remove(),document.getElementById("historyUpdateCostBtn").remove()}));var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,c,s,m,f,p,g;return t=e,n=null,c=[{key:"get",value:(g=l(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.default.get("history/get");case 2:return t=e.sent,e.next=5,t.json();case 5:d=e.sent,jplist.init({storage:"localStorage",storageName:"history-sorting"}),document.getElementById("loading").style.display="none",document.getElementById("wrapper").classList.remove("d-none"),document.getElementById("historyToolbar").classList.remove("d-none");case 10:case"end":return e.stop()}}),e)}))),function(){return g.apply(this,arguments)})},{key:"edit",value:(p=l(regeneratorRuntime.mark((function t(n){var r,o,c,s,l,u,m,f,p,g,y,h,v,b,T,E,x,B,M,I,w,C,k,L,F,j,H;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=function(e,t){var n=document.getElementById(e);return null!==n&&n.innerHTML.indexOf('value="'.concat(t,'"'))>-1},!n.target.classList.value.includes("historyEdit")){t.next=77;break}document.getElementById("historySave").insertAdjacentHTML("afterbegin",'\n      <button id="historyUpdateCostBtn" type="button" class="btn btn-warning" data-dismiss="modal">\n        Update Cost\n      </button>\n      <button id="historySaveBtn" type="button" class="btn btn-success" data-dismiss="modal">\n        Save Changes\n      </button>\n    '),document.getElementById("historySaveBtn").addEventListener("click",(function(t){e.save(n.target.id)})),document.getElementById("historyUpdateCostBtn").addEventListener("click",(function(t){e.updateCost(n.target.id)})),o=document.getElementById("printerName"),c=document.getElementById("fileName"),s=document.getElementById("printStatus"),l=document.getElementById("printerCost"),u=document.getElementById("printerTime"),m=document.getElementById("printTimeAccuracy"),f=document.getElementById("startDate"),p=document.getElementById("printTime"),g=document.getElementById("endDate"),y=document.getElementById("notes"),h=document.getElementById("dateUploaded"),v=document.getElementById("path"),b=document.getElementById("size"),T=document.getElementById("estimatedPrintTime"),E=document.getElementById("averagePrintTime"),x=document.getElementById("lastPrintTime"),B=document.getElementById("viewTable"),M=document.getElementById("jobCosting"),I=document.getElementById("jobHourlyCost"),B.innerHTML="",o.innerHTML=" - ",c.innerHTML=" - ",s.innerHTML=" - ",l.placeholder=" - ",u.placeholder=" - ",m.placeholder=" - ",f.innerHTML=" - ",p.innerHTML=" - ",g.innerHTML=" - ",y.placeholder="",h.placeholder=" - ",v.value=" - ",b.value=" - ",T.placeholder=" - ",E.placeholder=" - ",x.placeholder=" - ",M.placeholder=" - ",I.placeholder=" - ",(w=document.getElementById("history-thumbnail")).innerHTML="",C=_.findIndex(d.history,(function(e){return e._id==n.target.id})),k=d.history[C],o.innerHTML=k.printer,c.innerHTML=k.file.name,void 0!==k.thumbnail&&null!=k.thumbnail&&(w.innerHTML='<center><img src="'.concat(k.thumbnail,'" class="historyImage mb-2"></center>')),f.innerHTML="<b>Started</b><hr>".concat(k.startDate.replace(" - ","<br>")),p.innerHTML="<b>Duration</b><hr>".concat(a.default.generateTime(k.printTime)),g.innerHTML="<b>Finished</b><hr>".concat(k.endDate.replace(" - ","<br>")),l.value=k.printerCost,I.value=k.costPerHour,y.value=k.notes,u.value=a.default.generateTime(k.printTime),s.innerHTML="<b>Status</b><hr>".concat(k.state),void 0!==k.job&&null!==k.job&&(T.value=a.default.generateTime(k.job.estimatedPrintTime),m.value="".concat(k.job.printTimeAccuracy.toFixed(0)/100,"%")),M.value=k.totalCost,L=new Date(1e3*k.file.uploadDate),L="".concat(L.toLocaleDateString()," ").concat(L.toLocaleTimeString()),h.value=L,v.value=k.file.path,b.value=a.default.bytes(k.file.size),E.value=a.default.generateTime(k.file.averagePrintTime),x.value=a.default.generateTime(k.file.lastPrintTime),F=[],k.spools.forEach((function(e){var t=Object.keys(e)[0];F.push(t),B.insertAdjacentHTML("beforeend","\n          <tr>\n            <td>\n              <b>".concat(e[t].toolName,'</b>\n              </td>\n              <td>\n              <div class="input-group mb-3">\n                  <select id="filament-').concat(t,'" class="custom-select">\n                  </select>\n                  </div>\n              </td>\n              <td>\n              ').concat(e[t].volume.toFixed(2),"m3\n              </td>\n              <td>\n              ").concat(e[t].length.toFixed(2),"m\n              </td>\n              <td>\n                 ").concat(e[t].weight.toFixed(2),"g\n              </td>\n              <td>\n                 ").concat(e[t].cost,"\n              </td>\n              </tr>\n          </tr>\n        "))})),j=regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("filament-".concat(F[t])),e.next=3,(0,i.returnDropDown)();case 3:e.sent.forEach((function(e){n.insertAdjacentHTML("beforeend",e)})),null!==k.spools[t][F[t]].spoolId?(r(n.id,k.spools[t][F[t]].spoolId)||n.insertAdjacentHTML("afterbegin",'\n              <option value="'.concat(k.spools[t][F[t]].spoolId,'">').concat(k.spools[t][F[t]].spoolName,"</option>\n          ")),n.value=k.spools[t][F[t]].spoolId):n.value=0;case 6:case"end":return e.stop()}}),e)})),H=0;case 71:if(!(H<F.length)){t.next=76;break}return t.delegateYield(j(H),"t0",73);case 73:H++,t.next=71;break;case 76:B.insertAdjacentHTML("beforeend",'\n        <tr style="background-color:#303030;">\n        <td>\n        Totals\n        </td>\n        <td>\n\n        </td>\n        <td>\n        '.concat(k.totalVolume.toFixed(2),"m3\n        </td>\n        <td>\n        ").concat((k.totalLength/1e3).toFixed(2),"m\n        </td>\n        <td>\n        ").concat(k.totalWeight.toFixed(2),"g\n        </td>\n        <td>\n        ").concat(k.spoolCost,"\n        </td>\n        </tr>\n      "));case 77:case"end":return t.stop()}}),t)}))),function(e){return p.apply(this,arguments)})},{key:"updateCost",value:(f=l(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t},e.next=3,r.default.post("history/updateCostMatch",n);case 3:return i=e.sent,e.next=6,i.json();case 6:200===(i=e.sent).status?(o.default.createAlert("success","Successfully added your printers cost to history.",3e3,"clicked"),document.getElementById("printerCost-".concat(t)).innerHTML=a.default.returnPrintCost(i.costSettings,i.printTime)):(o.default.createAlert("warning","Printer no longer exists in database, default cost applied.",3e3,"clicked"),document.getElementById("printerCost-".concat(t)).innerHTML=a.default.returnPrintCost(i.costSettings,i.printTime));case 8:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"save",value:(m=l(regeneratorRuntime.mark((function e(t){var n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.querySelectorAll("[id^='filament-tool']"),a=[],n.forEach((function(e){a.push(e.value)})),i={id:t,note:document.getElementById("notes").value,filamentId:a},e.next=6,r.default.post("history/update",i);case 6:200===e.sent.status&&(o.default.createAlert("success","Successfully updated your history entry...",3e3,"clicked"),document.getElementById("note-".concat(t)).innerHTML=i.note,document.getElementById("spool-".concat(t)).innerHTML=i.filamentId);case 8:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"delete",value:(s=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.target.classList.value.includes("historyDelete")&&bootbox.confirm({message:"Are you sure you'd like to delete this entry? this is not reversible.",buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-danger"}},callback:function(e){return l(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t.target.id},e.next=3,r.default.post("history/delete",n);case 3:200===e.sent.status?(jplist.resetContent((function(){t.target.parentElement.parentElement.parentElement.remove()})),o.default.createAlert("success","Your history entry has been deleted...",3e3,"clicked")):o.default.createAlert("error","Hmmmm seems we couldn't contact the server to delete... is it online?",3e3,"clicked");case 5:case"end":return e.stop()}}),e)})))()}});case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"updateTotals",value:function(e){var t=[],n=[],r=[],o=[],i=[],c=[],s=[],l=[],u=[];e.forEach((function(e){t.push(parseInt(e.getElementsByClassName("time")[0].innerText)),isNaN(parseFloat(e.getElementsByClassName("filamentCost")[0].innerText))||n.push(parseFloat(e.getElementsByClassName("filamentCost")[0].innerText)),isNaN(parseFloat(e.getElementsByClassName("printerCost")[0].innerText))||r.push(parseFloat(e.getElementsByClassName("printerCost")[0].innerText)),isNaN(parseFloat(e.getElementsByClassName("totalUsageGrams")[0].innerText))||s.push(parseFloat(e.getElementsByClassName("totalUsageGrams")[0].innerText)),isNaN(parseFloat(e.getElementsByClassName("totalUsageMeter")[0].innerText))||l.push(parseFloat(e.getElementsByClassName("totalUsageMeter")[0].innerText));var a=e.getElementsByClassName("state")[0].innerText.trim();"Cancelled"===a&&o.push(a),"Failure"===a&&i.push(a),"Success"===a&&c.push(a),u.push(parseFloat(e.getElementsByClassName("costPerHour")[0].innerHTML))}));var d=u.reduce((function(e,t){return e+t}),0)/u.length,m=o.length+i.length+c.length,f=o.length/m*100,p=i.length/m*100,g=c.length/m*100,y=document.getElementById("totalFailurePercent");y.style.width="".concat(p.toFixed(2),"%"),y.innerHTML="".concat(p.toFixed(2),"%");var h=document.getElementById("totalSuccessPercent");h.style.width="".concat(g.toFixed(2),"%"),h.innerHTML="".concat(g.toFixed(2),"%");var v=document.getElementById("totalCancelledPercent");v.style.width="".concat(f.toFixed(2),"%"),v.innerHTML="".concat(f.toFixed(2),"%"),document.getElementById("totalCost").innerHTML=n.reduce((function(e,t){return e+t}),0).toFixed(2),document.getElementById("totalFilament").innerHTML="".concat(l.reduce((function(e,t){return e+t}),0).toFixed(2),"m / ").concat(s.reduce((function(e,t){return e+t}),0).toFixed(2),"g");var b=t.reduce((function(e,t){return e+t}),0);document.getElementById("totalPrintTime").innerHTML=a.default.generateTime(b),document.getElementById("printerTotalCost").innerHTML=r.reduce((function(e,t){return e+t}),0).toFixed(2),document.getElementById("combinedTotalCost").innerHTML=(parseFloat(r.reduce((function(e,t){return e+t}),0).toFixed(2))+parseFloat(n.reduce((function(e,t){return e+t}),0).toFixed(2))).toFixed(2),document.getElementById("averageCostPerHour").innerHTML=d.toFixed(2)}}],n&&u(t.prototype,n),c&&u(t,c),e}();n.default=m,document.getElementById("listenerHistory").addEventListener("jplist.state",(function(e){m.updateTotals(e.jplistState.filtered)}),!1),m.get()},{"./lib/functions/calc.js":2,"./lib/functions/ui.js":3,"./lib/modules/filamentGrab.js":4,"./lib/octofarm.js":5}],2:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"randomString",value:function(){return Math.random().toString(36).substr(2,5)}},{key:"toFixed",value:function(e,t){return null!=e?e.toFixed(t):0}},{key:"generateTime",value:function(e){var t="";if(void 0===e||isNaN(e)||null===e)t="No Time Estimate";else{Math.floor(e/131400);var n=Math.floor(e/86400);e-=3600*n*24;var r=Math.floor(e/3600);e-=3600*r;var a=Math.floor(e/60);e-=60*a,e=Math.floor(e),t="".concat(n,"d, ").concat(r,"h, ").concat(a,"m, ").concat(e,"s"),0==a&&t.includes("0m")&&(t=t.replace(" 0m,","")),0==r&&t.includes("0h")&&(t=t.replace(" 0h,","")),0==n&&t.includes("0d")&&(t=t.replace("0d,","")),0==a&&0==r&&0==n&&0==e&&(t=t.replace("0s","Done"))}return t}},{key:"isBetween",value:function(e,t,n){return(e-t)*(e-n)<=0}},{key:"returnPrintCost",value:function(e,t){if(void 0===e)return"No cost settings to calculate from";var n=t/3600,r=parseFloat(e.powerConsumption)*parseFloat(e.electricityCosts)*n,a=parseFloat(e.purchasePrice),o=parseFloat(e.estimateLifespan);return(r+((o>0?a/o:0)+parseFloat(e.maintenanceCosts))*n).toFixed(2)}},{key:"bytes",value:function(e,t){if(void 0===e||isNaN(e)||null===e)return"No File Estimate";if(0==e)return"0 Bytes";var n=t||2,r=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,r)).toFixed(n))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r])}},{key:"dateClean",value:function(e){return e=new Date(e),"".concat(e.getFullYear(),"-").concat(e.getMonth(),"-").concat(e.getDay(),": ").concat(e.getHours(),":").concat(e.getSeconds())}}],(n=null)&&r(t.prototype,n),a&&r(t,a),e}();n.default=a},{}],3:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"getColour",value:function(e){return"Operational"===e?{name:"secondary",hex:"#262626",category:"Idle"}:"Paused"===e?{name:"warning",hex:"#583c0e",category:"Idle"}:"Printing"===e||"Pausing"===e||"Cancelling"===e?{name:"warning",hex:"#583c0e",category:"Active"}:"Error"===e?{name:"danger",hex:"#2e0905",category:"Idle"}:"Offline"===e?{name:"danger",hex:"#2e0905",category:"Offline"}:"Searching..."===e?{name:"danger",hex:"#2e0905",category:"Idle"}:"Closed"===e?{name:"danger",hex:"#2e0905",category:"Closed"}:"Complete"===e?{name:"success",hex:"#00330e",category:"Complete"}:{name:"danger",hex:"#2e0905",category:"Offline"}}},{key:"createMessage",value:function(e,t){var n=document.getElementById(t),r='\n      <div class="alert alert-'.concat(e.type,' alert-dismissible fade show" role="alert">\n        ').concat(e.msg,'\n      <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    ');n.insertAdjacentHTML("beforeend",r)}},{key:"createAlert",value:function(e,t,n,r){r=null!=r?["click"]:[],Noty.setMaxVisible(50),new Noty({type:e,theme:"bootstrap-v4",closeWith:r,timeout:n,layout:"bottomRight",text:t}).show()}},{key:"doesElementNeedUpdating",value:function(e,t,n){e!==t[n]&&(t[n]=e)}}],(n=null)&&r(t.prototype,n),a&&r(t,a),e}();n.default=a},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.checkFilamentManager=function(){return c.apply(this,arguments)},n.returnDropDown=function(e){return s.apply(this,arguments)},n.selectFilament=function(e,t,n){return l.apply(this,arguments)};var r,a=(r=e("../octofarm.js"))&&r.__esModule?r:{default:r};function o(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function c(e){o(i,r,a,c,s,"next",e)}function s(e){o(i,r,a,c,s,"throw",e)}c(void 0)}))}}function c(){return(c=i(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.get("settings/server/get");case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,e.abrupt("return",t.filamentManager);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(){return(s=i(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.get("filament/get/dropDownList");case 2:return n=e.sent,e.next=5,n.json();case 5:if(n=e.sent,!t){e.next=10;break}return e.abrupt("return",n.selected.historyDropDown);case 10:return e.abrupt("return",n.selected.normalDropDown);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(){return(l=i(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={tool:r,printerId:t,spoolId:n},e.next=3,a.default.post("filament/select",o);case 3:e.sent;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},{"../octofarm.js":5}],5:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"get",value:function(e){var t="/".concat(e);return fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}})}},{key:"delete",value:function(e){var t="/".concat(e);return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}})}},{key:"post",value:function(e,t){var n="/".concat(e);return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}}],(n=null)&&r(t.prototype,n),a&&r(t,a),e}();n.default=a},{}]},{},[1]);
//# sourceMappingURL=historyRunner.min.js.map
